
# Bespoke Vulnerability Watch - Developer Guide


# Table of Contents

1. [Introduction](#Introduction)

2. [databaseLayer.py](#databaseLayer)

3. [db\_actions.db](#db_actions)

4. [Sources\_process.py](#Sources_process)

5. [db\_updater.py](#db\_updater)

6. [views.py (admin)](#views_admin)

7. [utils.py](#utils)

8. [views.py (home)](#views_home)

9. [admin.js](#admin_js)

10. [scripts.js](#scripts_js)

11. [statusses.js](#statusses)

12. [admin.html](#admin_html)

13. [menu.html](#menu)

14. [New files](#New_files)

<a id="Introduction"></a>
## Introduction

This file aims to help the futures developers to update our custom version of [CVE-Search](https://github.com/cve-search/cve-search) manually after a fresh new git clone from the original repository 


This documentation tries to be comprehensive, if you notice any missing part of code, please add it to this file.

Another way to check if everything has been added is to search globally (e.g. ctrl + maj + f on VScode) certain key words ("entity", "entities", "watchlist", "signal") on the repository.

<a id="databaseLayer"></a>
## databaseLayer.py

location: cve-search/lib/DatabaseLayer.py

Add these variables at the beginning of the file:
```
colENTITIES = db["entities"]
colWATCHLIST = db["watchlist"]
```

![databaselayer1](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/167a7c12-4c79-4c5a-82be-67ceb9be2577)

Add this variable to the function getDBStats(): **"watchlist": {}**

![databaselayer2](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/12bbf48e-76a4-4424-885f-649cc9e10d24)


Add these functions at the end of the file:
```
initWatchlist()
addEntity(entityName):
removeEntity(entityName):
addEntityCpe(entityName, cpe):
getAllEntities():
getEntityCpes(entityName):
deleteCPEFromEntity(entityName, cpe):
updateWatchlistCVE(doc):
updateWatchlistCVELastmodified(filter, date):
setWatchlistCVEComment(cveid, entity, product, comment):
switchWatchlistCVEStatus(cveid, entity, product):
deleteWatchlistCVE(cveid, en![databaselayer1](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/e252e98c-bdb0-4423-96a2-8318ecdd958c)
tity, product):
getWatchlistCVE(cveid, entity, product):
getWatchlistCVEbyID(cveid):
```

![databaselayer3](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/a2b3ec71-053a-4155-a082-ae2f58c39d5d)
![databaselayer4](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/00c04076-88ca-4116-b31b-148b82e4d8b5)

<a id="db_actions"></a>
## db\_actions.db

location: cve-search/lib/db\_action.py

Add import for signal and watchlist

![db_actions1](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/691626aa-8d65-47b5-b50e-52378d9afc0d)



This argument:
```
update_watchlist=False, signal_groups=[]
```
These variables:
```
self.update_watchlist = update_watchlist
self.signal_groups = signal_groups
```

And the if condition:
![db_actions2](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/60823de1-7b10-4072-83f4-05c56c6ecbb8)

Add the following function:
```
_update_watchlist(self)
```

![db_actions3](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/cb4c293c-2353-418c-b31b-f2a5c9f669b1)
![db_actions4](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/ecb987d1-4e25-41a1-bf23-801afb00751e)


<a id="Sources_process"></a>
## Sources\_process.py

location: cve-search/lib/Sources\_process.py

Add import for signal notifications:

![Sources_process1](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/955b1b4c-728a-45b8-a6e1-cd1253a778a0)


In \_\_init\_\_() function, add:

This argument:
```
update_watchlist=False, signal_groups=[]
```

These variables:
```
self.update_watchlist = update_watchlist
self.signal_groups = signal_groups
```

![Sources_process2](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/8e6c7d25-5143-4bc9-b5a9-5ef6ab84a192)



In function process\_item() add these variables:
```
update_watchlist=self.update_watchlist
signal_groups=self.signal_groups
```

![Sources_process3](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/5a389a70-3f12-4de7-9318-6404d030e23e)

<a id="Toolkit"></a>
## Toolkit.py

location: cve-search/lib/Toolkit.py

Add this import 

![Toolkit1](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/a037952c-9d2d-4080-b4e7-288ef68a1bca)


Add **isBlacklisted()** function

![Toolkit2](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/f5e914d9-9dd4-444e-b7e3-5730d61958ce)


<a id="db_updater"></a>
## db\_updater.py

location: cve-search/sbin/db\_updater.py

Import getInfo from lib.DatabaseLayer

![db_updater0](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/e17ea399-6c7f-4b25-b6a8-1cd89ed36f5f)


Add this function
```
argParser.add_argument()
```

![db_updater1](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/f2b507da-95e6-4ac5-8714-ae62f29c0a4c)


In else statement of "while loop", add what is related to signal notification and watchlist:

![db_updater2](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/0db739e4-a4f7-4eac-a4dc-0a88b47dc423)


<a id="views_admin"></a>
## views.py (admin)

location: cve-search/web/admin/views.py

Add these imports:

![view_admin0](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/04dec7bd-1679-44fc-b58e-7682e53e9111)


Add **view_entities(args, kwargs)** function

![views_admin1](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/82dc5590-931e-4066-9139-0b32c530d252)


Add **entities()** function

![views_admin2](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/3a9db509-66a0-4cae-830b-c25255f6bb42)


Add **entityAdd()** function

![views_admin3](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/23bec79f-289b-41ee-bfec-16125633f33f)


Add **entityRemove()** function

![views_admin4](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/47485293-1bd4-4f17-a11c-f417c459ca4b)


Add **entityCpeAdd()** function

![views_admin5](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/6707ee67-e267-4812-9cc6-91e600fd567d)


Add **verify()** function

![views_admin6](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/83c73df5-892c-444b-930e-87f2283f685d)


Add **verifyCaptcha()** function

![views_admin7](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/419f5191-fea7-4d18-b58e-8fb4f8585a7b)


Add **verifyCode()** function

![views_admin8](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/1787509c-937d-4d2f-8c02-77a341344752)

Add **changeThresholds()** function

![views_admin9](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/87d82e5f-7b26-48d8-bf6a-395e89ee7333)


Add **deleteEntityCpe()** function


![views_admin10](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/f4a9976b-aae5-41a0-9bdb-d74ddc6db4b1)

<a id="utils"></a>
## utils.py

location: cve-search/web/home/utils.py

import getInfo in lib.DatabaseLayer

![utils0](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/464e1a15-d138-4723-b020-269165bfc432)


In **generate\_minimal\_query()** function, add **threshold** related code

![utils1](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/d5ad6333-2618-4b45-a6d4-f1b2c68db4de)


In **adminInfo()** function, add:
```
"signalPhoneRegistered": getInfo('subscriptions')['registeredPhone'] != '',
watchlistInfos": getInfo('watchlist'),
```

![utils2](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/6d739670-666c-4287-b56a-c7062094cb1d)

<a id="views_home"></a>
## views.py (home)

location: cve-search/web/home/views.py

In import add:

```
from flask_login.utils import login_required
```

![views_home0](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/743dc7b5-7323-4056-9cab-de61bd20cbd8)

and 

```
getEntityCpes,
setWatchlistCVEComment,
switchWatchlistCVEStatus,
deleteWatchlistCVE,
getWatchlistCVE,
```

![view_home1](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/b2b6d1e3-5e21-47fb-a124-60a293d98712)

Add **view\_cpe\_name()** function


![view_home2](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/d50f311e-00e4-47ce-8123-aab059835ea9)

Add **view\_entity\_name()** function:

![view_home3](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/fda0de5e-b651-4114-9c28-870db2416a72)


Add **search\_entity(**) function:

![view_home4](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/76de69c9-5129-4753-8911-d36ec30f8f57)


Add **browse\_entity()** function

![view_home5](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/57105d31-7d4b-40b4-b2a5-6877e859de9f)


Add **watchlist()** function

![view_home6](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/c2cd4468-b7a0-40ec-8c7d-b95a31f56aa7)


Add **watchlist\_cve()** function

![view_home7](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/9c27e7db-eec2-4a78-baf0-8ec6df69369b)


Add **save\_comment()** function

![view_home8](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/5587dc36-ef44-419d-a973-082b2a4b9f16)


Add **switch\_status()** function


![view_home9](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/7981e8c5-268c-4660-af30-7ce18791b93b)

Add **delete\_from\_watchlist()** function

![view_home10](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/6c34d2f7-32cb-4821-b155-07b88a8d05f0)


Add **delete\_filtered\_watchlist()** function

![view_home11](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/d71783fa-8ac7-486a-b238-b2eca1290147)

Add **export\_csv()** function

![view_home12](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/6f9ff805-87e0-4852-938d-dfca9c45a159)


Add **export\_notice()** function

![view_home13](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/4f5e3523-60ed-457e-b5ee-15fa2e93bd4b)

<a id="admin_js"></a>
## admin.js

Location: cve-search/web/static/js/custom/admin.js

Add **verify()** function

![admin_js1](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/99bfbce4-888d-4bb7-ab4e-47f1298ff25e)


Add **verifyCaptcha()** function

![admin_js2](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/c349739e-9dc3-4d38-bf3a-9afb659f3f67)


Add **verifyCode()** function

![admin_js3](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/be4ea627-66f7-458b-9f53-ade89d88e7a7)



<a id="scripts_js"></a>
## scripts.js

Location: cve-search/web/static/js/custom/statuscriptssses.js

Add **escapeHtml()** function


![script_js1](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/7d398ff3-58a8-4fda-b4bd-7792c3d13fcb)

<a id="statusses"></a>
## statusses.js

Location: cve-search/web/static/js/custom/statusses.js

In **parseStatus()**, add these cases

![statusses](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/dcc4100e-52f7-491b-9617-0e7d483d5e8c)


<a id="admin_html"></a>
## admin.html

location: cve-search/web/templates/admin.html

Add **related watchlist** code button

![admin1](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/5b1d7197-67b0-425a-95b7-f1cf7dbef973)

Add **entities management**

![admin2](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/bb3c6c22-cdd6-45c3-b38d-a89b120823a5)


Add CVSS threshold

![admin3](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/d1c4158b-d9fe-45fe-96f9-6060e4745ed5)


Add signal notifications

![admin4](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/cfc22c75-e8f8-4cd5-924e-535f5583ca9b)

<a id="menu"></a>
## menu.html

Location: cve-search/web/templates/subpages/menu.html

Add link related to watchlist, vendor and entity

![menu](https://github.com/Dlux-cyber-projects/cve-search-2023/assets/82516361/d1ae5f27-504b-4c02-970c-2775122306e3)


<a id="New_files"></a>
## New files

Locations:
cve-search/lib/signalNotification.py

 
cve-search/web/static/css/custom/entities.css

cve-search/web/static/css/custom/entities.css

cve-search/web/static/css/custom/watchlistCVE.css

cve-search/web/static/css/custom/watchlistCVE.css

 

cve-search/web/static/js/custom/entities.js

cve-search/web/static/js/custom/entities.js

cve-search/web/static/js/custom/watchlist.js

cve-search/web/static/js/custom/watchlistCVE.js

cve-search/web/static/js/custom/watchlistCVE.js

 

cve-search/web/templates/browse_entity_products.html

cve-search/web/templates/browse_entity_products.html

 

cve-search/web/templates/entities.html

cve-search/web/templates/entities.html

cve-search/web/templates/search_entity.html

cve-search/web/templates/search_entity.html

cve-search/web/templates/watchlist.html

cve-search/web/templates/watchlistCve.html

 

cve-search/web/templates/subpages/browse_entity.html

cve-search/web/templates/subpages/browse_entity.html

cve-search/web/templates/subpages/static_table.html

cve-search/web/templates/subpages/static_table.html

cve-search/web/templates/subpages/watchlist_table.html

cve-search/web/templates/subpages/watchlist_table.html

Add these new files.
